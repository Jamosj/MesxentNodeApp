name: Build Mesxent APK
on: [push, workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Force Create Project Structure
        run: |
          # Create the settings file
          echo "include ':app'" > settings.gradle
          
          # Create the Root Build File
          cat <<EOF > build.gradle
          buildscript {
              repositories { google(); mavenCentral() }
              dependencies { classpath 'com.android.tools.build:gradle:8.1.0' }
          }
          allprojects {
              repositories { google(); mavenCentral() }
          }
          EOF

          # Create the App Build File
          mkdir -p app
          cat <<EOF > app/build.gradle
          plugins { id 'com.android.application' }
          android {
              namespace 'com.mesxent.node'
              compileSdk 33
              defaultConfig {
                  applicationId "com.mesxent.node"
                  minSdk 24
                  targetSdk 33
                  versionCode 1
                  versionName "1.0"
              }
          }
          EOF

      - name: Build APK
        run: |
          gradle assembleDebug
          
      - name: Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          name: MesxentNode-Alpha
          path: app/build/outputs/apk/debug/app-debug.apk